<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#1B4332">
<meta name="description" content="Sikkim Family Trip Planner â€” March 1-7, 2026. Budget, itinerary & expense tracker.">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”ï¸</text></svg>">
<title>ğŸ”ï¸ Sikkim Family Trip 2026</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --primary:#1B4332;--primary-light:#2D6A4F;--primary-lighter:#40916C;
  --accent:#F77F00;--accent-light:#FCBF49;
  --bg:#F0F4F0;--card:#FFFFFF;--text:#1a1a2e;--text-light:#555;--text-muted:#888;
  --border:#E0E7E0;--danger:#E63946;--success:#2D6A4F;
  --shadow:0 2px 12px rgba(0,0,0,0.08);--shadow-lg:0 8px 30px rgba(0,0,0,0.12);
  --radius:14px;--radius-sm:10px;
}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;-webkit-font-smoothing:antialiased;overflow-x:hidden;padding-bottom:env(safe-area-inset-bottom)}
.container{max-width:480px;margin:0 auto;padding:0 16px calc(40px + env(safe-area-inset-bottom))}

/* ===== HERO ===== */
.hero{position:relative;height:380px;overflow:hidden;display:flex;align-items:flex-end;justify-content:center}
.hero-bg{position:absolute;inset:0;z-index:0}
.hero-bg img{width:100%;height:100%;object-fit:cover;object-position:center 30%}
.hero-bg::after{content:'';position:absolute;inset:0;background:linear-gradient(to bottom,rgba(27,67,50,0.1) 0%,rgba(27,67,50,0.5) 50%,rgba(27,67,50,0.92) 100%)}
.hero-content{position:relative;z-index:1;text-align:center;color:#fff;padding:0 20px calc(40px + env(safe-area-inset-top));width:100%}
.hero-content h1{font-size:1.8rem;font-weight:800;letter-spacing:-0.5px;text-shadow:0 2px 20px rgba(0,0,0,0.3);margin-bottom:4px}
.hero-content .subtitle{font-size:0.95rem;opacity:0.9;margin-bottom:14px;font-weight:500}
.hero-content .dates{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,0.18);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);padding:8px 20px;border-radius:30px;font-size:0.85rem;font-weight:600;border:1px solid rgba(255,255,255,0.2)}
.hero-content .route{margin-top:10px;font-size:0.78rem;opacity:0.8;letter-spacing:0.3px}
.hero-wave{position:absolute;bottom:-2px;left:0;right:0;z-index:2}
.hero-wave svg{display:block;width:100%}

/* ===== ABOUT SIKKIM ===== */
.about{padding:24px 16px 8px;max-width:480px;margin:0 auto}
.about-title{font-size:1.05rem;font-weight:700;margin-bottom:10px;display:flex;align-items:center;gap:8px}
.about-text{font-size:0.82rem;color:var(--text-light);line-height:1.7;margin-bottom:16px}
.photo-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:20px}
.photo-grid .photo{border-radius:12px;overflow:hidden;aspect-ratio:1;position:relative}
.photo-grid .photo img{width:100%;height:100%;object-fit:cover;transition:transform 0.3s}
.photo-grid .photo:active img{transform:scale(1.05)}
.photo-grid .photo .photo-label{position:absolute;bottom:0;left:0;right:0;padding:6px 8px;background:linear-gradient(transparent,rgba(0,0,0,0.7));color:#fff;font-size:0.6rem;font-weight:600;text-align:center}
.highlights{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:20px}
.highlight{background:var(--card);border-radius:var(--radius-sm);padding:12px;text-align:center;box-shadow:var(--shadow)}
.highlight .h-emoji{font-size:1.4rem;margin-bottom:4px}
.highlight .h-title{font-size:0.75rem;font-weight:700;color:var(--primary)}
.highlight .h-sub{font-size:0.65rem;color:var(--text-muted)}

/* ===== SYNC STATUS ===== */
.sync-bar{display:flex;align-items:center;justify-content:center;gap:6px;padding:6px;font-size:0.7rem;color:var(--text-muted);background:var(--card);border-radius:20px;margin:0 16px 12px;max-width:448px;margin-left:auto;margin-right:auto;box-shadow:var(--shadow)}
.sync-dot{width:8px;height:8px;border-radius:50%;background:#ccc;transition:background 0.3s}
.sync-dot.synced{background:#4caf50}
.sync-dot.syncing{background:var(--accent);animation:pulse 1s infinite}
.sync-dot.error{background:var(--danger)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}

/* ===== STATS ===== */
.stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:0 16px 14px;max-width:448px;margin-left:auto;margin-right:auto}
.stat-card{background:var(--card);border-radius:var(--radius-sm);padding:14px;text-align:center;box-shadow:var(--shadow)}
.stat-card .num{font-size:1.3rem;font-weight:800;color:var(--primary)}
.stat-card .label{font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px;margin-top:2px}

/* ===== TABS ===== */
.tabs{display:flex;gap:4px;margin:0 0 16px;background:var(--card);border-radius:var(--radius-sm);padding:4px;box-shadow:var(--shadow);position:sticky;top:0;z-index:10}
.tab{flex:1;padding:12px 4px;border:none;background:transparent;font-size:0.72rem;font-weight:600;color:var(--text-muted);border-radius:var(--radius-sm);cursor:pointer;transition:all 0.2s;text-align:center;min-height:44px;-webkit-tap-highlight-color:transparent;display:flex;flex-direction:column;align-items:center;justify-content:center}
.tab.active{background:var(--primary);color:#fff;box-shadow:0 2px 8px rgba(27,67,50,0.3)}

/* ===== SECTIONS ===== */
.section{display:none}
.section.active{display:block}
.section-title{font-size:1.1rem;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:8px}

/* ===== CARDS ===== */
.card{background:var(--card);border-radius:var(--radius);padding:16px;margin-bottom:12px;box-shadow:var(--shadow)}

/* ===== MEMBERS ===== */
.member-input{display:flex;gap:8px;margin-bottom:14px}
.member-input input{flex:1;padding:14px;border:2px solid var(--border);border-radius:var(--radius-sm);font-size:16px;outline:none;transition:border 0.2s;-webkit-appearance:none}
.member-input input:focus{border-color:var(--primary)}
.member-input button{padding:14px 20px;background:var(--primary);color:#fff;border:none;border-radius:var(--radius-sm);font-size:16px;font-weight:600;cursor:pointer;min-height:48px;-webkit-tap-highlight-color:transparent}
.member{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;background:var(--bg);border-radius:var(--radius-sm);margin-bottom:8px}
.member .name{font-weight:600;display:flex;align-items:center;gap:8px}
.member .avatar{width:34px;height:34px;border-radius:50%;color:#fff;display:flex;align-items:center;justify-content:center;font-size:0.8rem;font-weight:700}
.member .remove{background:none;border:none;color:var(--danger);font-size:1.2rem;cursor:pointer;padding:8px;border-radius:8px;min-width:40px;min-height:40px;display:flex;align-items:center;justify-content:center}

/* ===== BUDGET ===== */
.budget-group{margin-bottom:16px}
.budget-group-title{font-size:0.8rem;font-weight:700;color:var(--primary);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px;padding-bottom:6px;border-bottom:2px solid var(--border)}
.budget-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #f0f0f0;gap:10px}
.budget-row:last-child{border:none}
.budget-row .item{font-size:0.85rem;color:var(--text);flex:1;min-width:0}
.budget-row .item small{display:block;color:var(--text-muted);font-size:0.7rem}
.budget-row .amount{font-weight:700;color:var(--primary);font-size:0.9rem;text-align:right;white-space:nowrap}
.budget-row input[type=number]{width:100px;padding:10px;border:2px solid var(--border);border-radius:8px;font-size:16px;text-align:right;font-weight:600;outline:none;-webkit-appearance:none;min-height:44px}
.budget-row input:focus{border-color:var(--primary)}
.budget-total{display:flex;justify-content:space-between;padding:14px 16px;background:var(--primary);color:#fff;border-radius:var(--radius-sm);margin-top:12px;font-weight:700;font-size:1rem}
.budget-pp{text-align:center;padding:12px;background:var(--accent);color:#fff;border-radius:var(--radius-sm);margin-top:8px;font-weight:700;font-size:1.05rem}

/* ===== ITINERARY ===== */
.day-card{border-left:3px solid var(--primary-lighter);padding-left:14px;margin-bottom:18px;position:relative}
.day-card::before{content:'';position:absolute;left:-7px;top:6px;width:11px;height:11px;background:var(--primary);border-radius:50%;border:2px solid #fff;box-shadow:0 0 0 2px var(--primary-lighter)}
.day-date{font-size:0.7rem;color:var(--accent);font-weight:700;text-transform:uppercase;letter-spacing:0.5px}
.day-title{font-size:0.95rem;font-weight:700;margin:2px 0 6px}
.day-desc{font-size:0.82rem;color:var(--text-light);line-height:1.6}
.day-tag{display:inline-block;padding:3px 10px;background:var(--bg);border-radius:20px;font-size:0.7rem;color:var(--primary);font-weight:600;margin-top:6px;margin-right:4px}
.day-highlight{background:linear-gradient(135deg,#f0fff4,#e8f5e9);padding:12px;border-radius:var(--radius-sm);margin-top:8px;font-size:0.78rem;border:1px solid #c8e6c9}
.day-photo{width:100%;border-radius:var(--radius-sm);margin-top:10px;aspect-ratio:16/9;object-fit:cover}

/* ===== EXPENSES ===== */
.expense-form{margin-bottom:16px}
.form-row{margin-bottom:10px}
.form-row label{display:block;font-size:0.75rem;font-weight:600;color:var(--text-muted);margin-bottom:4px;text-transform:uppercase;letter-spacing:0.3px}
.form-row input,.form-row select{width:100%;padding:13px 14px;border:2px solid var(--border);border-radius:var(--radius-sm);font-size:16px;outline:none;background:#fff;transition:border 0.2s;-webkit-appearance:none;min-height:48px}
.form-row select{background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23555' d='M6 8L1 3h10z'/%3E%3C/svg%3E") no-repeat right 14px center #fff;padding-right:36px}
.form-row input:focus,.form-row select:focus{border-color:var(--primary)}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.btn-add{width:100%;padding:14px;background:var(--accent);color:#fff;border:none;border-radius:var(--radius-sm);font-size:16px;font-weight:700;cursor:pointer;min-height:48px}
.expense-item{display:flex;align-items:center;gap:10px;padding:12px;background:var(--bg);border-radius:var(--radius-sm);margin-bottom:8px}
.expense-item .emoji{font-size:1.3rem;flex-shrink:0}
.expense-item .details{flex:1;min-width:0}
.expense-item .details .desc{font-weight:600;font-size:0.85rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.expense-item .details .meta{font-size:0.7rem;color:var(--text-muted)}
.expense-item .exp-amount{font-weight:800;color:var(--primary);font-size:0.95rem;white-space:nowrap}
.expense-item .delete{background:none;border:none;color:var(--danger);cursor:pointer;padding:8px;border-radius:8px;min-width:36px;min-height:36px;display:flex;align-items:center;justify-content:center;opacity:0.5;font-size:0.85rem}
.expense-item .delete:active{opacity:1;background:rgba(230,57,70,0.1)}
.expense-day-header{font-size:0.75rem;font-weight:700;color:var(--accent);text-transform:uppercase;letter-spacing:0.5px;margin:16px 0 8px;padding-bottom:4px;border-bottom:2px dashed var(--border)}
.no-expenses{text-align:center;padding:30px;color:var(--text-muted);font-size:0.85rem}

/* ===== SUMMARY ===== */
.summary-card{text-align:center;padding:20px;margin-bottom:12px}
.summary-card .big-num{font-size:2rem;font-weight:800;color:var(--primary)}
.summary-card .big-label{font-size:0.8rem;color:var(--text-muted)}
.split-item{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:var(--bg);border-radius:var(--radius-sm);margin-bottom:8px}
.split-item .split-name{font-weight:600;font-size:0.85rem}
.split-item .split-paid{font-size:0.85rem;color:var(--primary);font-weight:700;white-space:nowrap}
.split-item .split-owe{font-size:0.75rem;color:var(--text-muted)}
.share-btn{width:100%;padding:14px;background:var(--primary);color:#fff;border:none;border-radius:var(--radius-sm);font-size:16px;font-weight:700;cursor:pointer;margin-top:12px;display:flex;align-items:center;justify-content:center;gap:8px;min-height:48px}
.share-btn.secondary{background:var(--accent)}

/* ===== TOAST ===== */
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--primary);color:#fff;padding:12px 24px;border-radius:30px;font-size:0.85rem;font-weight:600;box-shadow:var(--shadow-lg);transition:transform 0.3s ease;z-index:100;white-space:nowrap;max-width:90vw;text-overflow:ellipsis;overflow:hidden}
.toast.show{transform:translateX(-50%) translateY(0)}

/* ===== RESPONSIVE ===== */
@media(max-width:360px){
  .hero{height:300px}
  .hero-content h1{font-size:1.4rem}
  .stats{gap:8px;margin:0 12px 12px}
  .stat-card{padding:10px}
  .stat-card .num{font-size:1.1rem}
  .tab{font-size:0.65rem;padding:10px 2px}
  .form-grid{grid-template-columns:1fr}
  .photo-grid{gap:6px}
  .highlights{gap:6px}
}
@media(min-width:500px){
  .container{padding:0 24px 100px}
  .hero{height:440px}
  .hero-content h1{font-size:2.2rem}
}

/* Touch */
button,a,.tab{-webkit-tap-highlight-color:transparent}
button:active,.tab:active{transform:scale(0.97)}
.tab,.member .remove,.delete{-webkit-user-select:none;user-select:none}
html{scroll-behavior:smooth}

.empty-state{text-align:center;padding:40px 20px;color:var(--text-muted)}
.empty-state .emoji{font-size:2.5rem;margin-bottom:10px}

/* Loading shimmer */
.shimmer{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0 50%,#f0f0f0 75%);background-size:200% 100%;animation:shimmer 1.5s infinite}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
</style>
</head>
<body>

<!-- ===== HERO ===== -->
<div class="hero">
  <div class="hero-bg">
    <img src="https://images.unsplash.com/photo-1626621341517-bbf3d9990a23?w=800&q=80" alt="Sikkim Mountains" loading="eager">
  </div>
  <div class="hero-content">
    <h1>Sikkim Family Trip ğŸ”ï¸</h1>
    <p class="subtitle">Where mountains meet the sky</p>
    <div class="dates">ğŸ“… March 1 â€” 7, 2026</div>
    <p class="route">Patna â†’ NJP â†’ Gangtok â†’ Lachung â†’ Yumthang â†’ Patna</p>
  </div>
  <div class="hero-wave">
    <svg viewBox="0 0 1440 60" fill="none"><path d="M0,40 C360,70 720,0 1080,40 C1260,55 1380,45 1440,40 L1440,60 L0,60Z" fill="#F0F4F0"/></svg>
  </div>
</div>

<!-- ===== ABOUT SIKKIM ===== -->
<div class="about" id="aboutSection">
  <div class="about-title">âœ¨ About the Destination</div>
  <p class="about-text">
    Sikkim â€” a paradise tucked in the northeast Himalayas. Home to the majestic <strong>Kanchenjunga</strong> (world's 3rd highest peak), sacred monasteries, frozen lakes, and the stunning <strong>Yumthang Valley of Flowers</strong>. From the bustling MG Marg in Gangtok to the snow-covered Zero Point at 15,300 ft â€” this trip takes us through some of India's most breathtaking landscapes. ğŸŒ„
  </p>

  <div class="photo-grid">
    <div class="photo">
      <img src="https://images.unsplash.com/photo-1622397745187-4505c20adfc8?w=300&q=80" alt="Gangtok" loading="lazy">
      <div class="photo-label">Gangtok</div>
    </div>
    <div class="photo">
      <img src="https://images.unsplash.com/photo-1636466497217-26a8cbeaf0aa?w=300&q=80" alt="Tsomgo Lake" loading="lazy">
      <div class="photo-label">Tsomgo Lake</div>
    </div>
    <div class="photo">
      <img src="https://images.unsplash.com/photo-1614512210750-8aab39580399?w=300&q=80" alt="Mountains" loading="lazy">
      <div class="photo-label">Kanchenjunga</div>
    </div>
    <div class="photo">
      <img src="https://images.unsplash.com/photo-1633512810647-e93fbf498e2a?w=300&q=80" alt="Monastery" loading="lazy">
      <div class="photo-label">Monastery</div>
    </div>
    <div class="photo">
      <img src="https://images.unsplash.com/photo-1626015449887-1eafb3791e67?w=300&q=80" alt="Yumthang" loading="lazy">
      <div class="photo-label">Yumthang</div>
    </div>
    <div class="photo">
      <img src="https://images.unsplash.com/photo-1544735716-392fe2489ffa?w=300&q=80" alt="Prayer Flags" loading="lazy">
      <div class="photo-label">Prayer Flags</div>
    </div>
  </div>

  <div class="highlights">
    <div class="highlight"><div class="h-emoji">ğŸ”ï¸</div><div class="h-title">15,300 ft</div><div class="h-sub">Zero Point altitude</div></div>
    <div class="highlight"><div class="h-emoji">ğŸ“…</div><div class="h-title">7 Days</div><div class="h-sub">March 1-7, 2026</div></div>
    <div class="highlight"><div class="h-emoji">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div><div class="h-title" id="hlMembers">8 People</div><div class="h-sub">Family trip</div></div>
    <div class="highlight"><div class="h-emoji">ğŸš‚</div><div class="h-title">Vande Bharat</div><div class="h-sub">Patna â†” NJP</div></div>
  </div>
</div>

<!-- ===== SYNC STATUS ===== -->
<div class="sync-bar">
  <div class="sync-dot" id="syncDot"></div>
  <span id="syncText">Connecting...</span>
</div>

<!-- ===== STATS ===== -->
<div class="stats">
  <div class="stat-card"><div class="num" id="statTotal">â€”</div><div class="label">Total Budget</div></div>
  <div class="stat-card"><div class="num" id="statPP">â€”</div><div class="label">Per Person</div></div>
  <div class="stat-card"><div class="num" id="statMembers">0</div><div class="label">Members</div></div>
  <div class="stat-card"><div class="num" id="statSpent">â‚¹0</div><div class="label">Spent So Far</div></div>
</div>

<div class="container">
  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-tab="members">ğŸ‘¥ Team</button>
    <button class="tab" data-tab="budget">ğŸ’° Budget</button>
    <button class="tab" data-tab="itinerary">ğŸ—“ï¸ Plan</button>
    <button class="tab" data-tab="expenses">ğŸ§¾ Track</button>
    <button class="tab" data-tab="summary">ğŸ“Š Split</button>
  </div>

  <!-- ===== MEMBERS ===== -->
  <div class="section active" id="sec-members">
    <div class="section-title">ğŸ‘¥ Family Members</div>
    <div class="member-input">
      <input type="text" id="memberName" placeholder="Add family member..." maxlength="30">
      <button onclick="addMember()">Add</button>
    </div>
    <div id="membersList"></div>
  </div>

  <!-- ===== BUDGET ===== -->
  <div class="section" id="sec-budget">
    <div class="section-title">ğŸ’° Trip Budget</div>
    <div class="card">
      <div class="budget-group">
        <div class="budget-group-title">ğŸš‚ Transport</div>
        <div class="budget-row"><div class="item">Vande Bharat: Patna â†’ NJP<small>â‚¹1,500 Ã— <span class="m-count">8</span> ppl</small></div><div class="amount" id="calcTrainGo"></div></div>
        <div class="budget-row"><div class="item">Vande Bharat: NJP â†’ Patna<small>â‚¹1,200 Ã— <span class="m-count">8</span> ppl</small></div><div class="amount" id="calcTrainReturn"></div></div>
        <div class="budget-row"><div class="item">Taxi: NJP â†’ Gangtok<small>Shared vehicle</small></div><div class="amount">â‚¹4,000</div></div>
        <div class="budget-row"><div class="item">Taxi: Gangtok â†’ NJP<small>Shared vehicle</small></div><div class="amount">â‚¹4,000</div></div>
        <div class="budget-row"><div class="item">Local Sightseeing<small>Tsomgo, Lachung-Yumthang, Local</small></div><div class="amount"><input type="number" id="budgetLocalTaxi" value="14000" onchange="onBudgetChange()"></div></div>
      </div>
      <div class="budget-group">
        <div class="budget-group-title">ğŸ¨ Accommodation</div>
        <div class="budget-row"><div class="item">Hotels (4 nights)<small>Gangtok + Lachung + NJP</small></div><div class="amount"><input type="number" id="budgetAccom" value="27500" onchange="onBudgetChange()"></div></div>
      </div>
      <div class="budget-group">
        <div class="budget-group-title">ğŸ½ï¸ Food</div>
        <div class="budget-row"><div class="item">Meals (6 days)<small>~â‚¹400/person/day Ã— <span class="m-count">8</span> Ã— 6</small></div><div class="amount"><input type="number" id="budgetFood" value="19200" onchange="onBudgetChange()"></div></div>
      </div>
      <div class="budget-group">
        <div class="budget-group-title">ğŸ« Permits & Entry</div>
        <div class="budget-row"><div class="item">Nathula/Tsomgo + entries<small>~â‚¹300/person</small></div><div class="amount"><input type="number" id="budgetPermits" value="2500" onchange="onBudgetChange()"></div></div>
      </div>
      <div class="budget-group">
        <div class="budget-group-title">ğŸ’ Miscellaneous</div>
        <div class="budget-row"><div class="item">Shopping, tips, snacks<small>Buffer amount</small></div><div class="amount"><input type="number" id="budgetMisc" value="5000" onchange="onBudgetChange()"></div></div>
      </div>
      <div class="budget-total"><span>Total Estimated</span><span id="budgetGrandTotal">â€”</span></div>
      <div class="budget-pp" id="budgetPerPerson">â€”</div>
    </div>
  </div>

  <!-- ===== ITINERARY ===== -->
  <div class="section" id="sec-itinerary">
    <div class="section-title">ğŸ—“ï¸ Day-by-Day Plan</div>

    <div class="day-card">
      <div class="day-date">Day 1 Â· Sun, March 1</div>
      <div class="day-title">ğŸš‚ Patna â†’ NJP</div>
      <div class="day-desc">Board Vande Bharat Express at <strong>13:00</strong> from Patna. Scenic ride through Bihar & Bengal. Carry packed dinner â€” arrive NJP late evening.</div>
      <div class="day-tag">ğŸš‚ Vande Bharat</div><div class="day-tag">ğŸ• Departs 1 PM</div>
      <div class="day-highlight">ğŸ’¡ Reach station by 12:15. Keep warm clothes accessible in hand baggage.</div>
    </div>

    <div class="day-card">
      <div class="day-date">Day 2 Â· Mon, March 2</div>
      <div class="day-title">ğŸ“ Arrive Gangtok</div>
      <div class="day-desc">Morning taxi from NJP to Gangtok (~4.5 hrs through winding mountain roads). Check in. Evening stroll at <strong>MG Marg</strong> â€” momos, thukpa, and shopping!</div>
      <div class="day-tag">ğŸš 4.5 hr drive</div><div class="day-tag">ğŸŒƒ MG Marg</div><div class="day-tag">ğŸ¥Ÿ Momos!</div>
      <img class="day-photo" src="https://images.unsplash.com/photo-1622397745187-4505c20adfc8?w=600&q=75" alt="Gangtok MG Marg" loading="lazy">
    </div>

    <div class="day-card">
      <div class="day-date">Day 3 Â· Tue, March 3</div>
      <div class="day-title">â„ï¸ Tsomgo Lake & Baba Mandir</div>
      <div class="day-desc">Full day excursion! <strong>Tsomgo Lake</strong> (12,310 ft) â€” frozen & magical in March. Visit <strong>Baba Harbhajan Singh Mandir</strong>. Try for <strong>Nathula Pass</strong> (India-China border) if open.</div>
      <div class="day-tag">ğŸ“¸ Tsomgo Lake</div><div class="day-tag">ğŸ›• Baba Mandir</div><div class="day-tag">ğŸ‡®ğŸ‡³ Nathula</div>
      <div class="day-highlight">ğŸ’¡ <strong>Note:</strong> Nathula closed Mon & Tue. March 3 is Tuesday! If closed, do Tsomgo + Baba Mandir + Gangtok sightseeing instead. Apply permits on Day 2.</div>
      <img class="day-photo" src="https://images.unsplash.com/photo-1636466497217-26a8cbeaf0aa?w=600&q=75" alt="Tsomgo Lake" loading="lazy">
    </div>

    <div class="day-card">
      <div class="day-date">Day 4 Â· Wed, March 4</div>
      <div class="day-title">ğŸ”ï¸ Gangtok â†’ Lachung</div>
      <div class="day-desc">Breathtaking 5-6 hour drive through mountain passes. Pass Chungthang, see Lachen-Lachung river confluence. Overnight in <strong>Lachung village</strong> at 8,610 ft.</div>
      <div class="day-tag">ğŸš— 5-6 hrs</div><div class="day-tag">ğŸ¡ Lachung</div><div class="day-tag">ğŸ“¸ Scenic</div>
    </div>

    <div class="day-card">
      <div class="day-date">Day 5 Â· Thu, March 5</div>
      <div class="day-title">ğŸŒ¸ Yumthang & Zero Point</div>
      <div class="day-desc">Early morning to <strong>Yumthang Valley</strong> â€” "Valley of Flowers" (11,800 ft). Continue to <strong>Zero Point</strong> (15,300 ft) if road is open â€” pure snow! Return to Gangtok by evening.</div>
      <div class="day-tag">ğŸŒº Yumthang</div><div class="day-tag">â„ï¸ Zero Point</div><div class="day-tag">ğŸ“¸ Snow!</div>
      <div class="day-highlight">ğŸ’¡ Zero Point depends on weather. Carry gloves, caps, sunscreen. Return to Gangtok is 5-6 hrs.</div>
      <img class="day-photo" src="https://images.unsplash.com/photo-1626015449887-1eafb3791e67?w=600&q=75" alt="Yumthang Valley" loading="lazy">
    </div>

    <div class="day-card">
      <div class="day-date">Day 6 Â· Fri, March 6</div>
      <div class="day-title">ğŸ›ï¸ Gangtok â†’ NJP</div>
      <div class="day-desc">Morning: <strong>Rumtek Monastery</strong>, <strong>Hanuman Tok</strong>, <strong>Tashi Viewpoint</strong> (Kanchenjunga view!). MG Marg shopping. Afternoon drive to NJP, overnight near station.</div>
      <div class="day-tag">ğŸ›• Rumtek</div><div class="day-tag">ğŸ›ï¸ Shopping</div><div class="day-tag">ğŸš NJP</div>
    </div>

    <div class="day-card">
      <div class="day-date">Day 7 Â· Sat, March 7</div>
      <div class="day-title">ğŸ  NJP â†’ Patna</div>
      <div class="day-desc">Board Vande Bharat at <strong>5:10 AM</strong> from NJP. Share trip photos, relive the memories. Arrive Patna by afternoon. ğŸ </div>
      <div class="day-tag">ğŸš‚ Vande Bharat</div><div class="day-tag">ğŸ• 5:10 AM</div><div class="day-tag">ğŸ  Home!</div>
      <div class="day-highlight">âš ï¸ Set multiple alarms! Pack bags the night before. Keep breakfast ready.</div>
    </div>
  </div>

  <!-- ===== EXPENSES ===== -->
  <div class="section" id="sec-expenses">
    <div class="section-title">ğŸ§¾ Daily Expenses</div>
    <div class="card expense-form">
      <div class="form-row"><label>What was it for?</label><input type="text" id="expDesc" placeholder="e.g. Lunch at MG Marg" maxlength="50"></div>
      <div class="form-grid">
        <div class="form-row"><label>Amount (â‚¹)</label><input type="number" id="expAmount" placeholder="500" min="0" inputmode="numeric"></div>
        <div class="form-row"><label>Category</label>
          <select id="expCategory">
            <option value="ğŸ½ï¸ Food">ğŸ½ï¸ Food</option>
            <option value="ğŸš— Transport">ğŸš— Transport</option>
            <option value="ğŸ¨ Stay">ğŸ¨ Stay</option>
            <option value="ğŸ« Entry/Permit">ğŸ« Entry</option>
            <option value="ğŸ›ï¸ Shopping">ğŸ›ï¸ Shopping</option>
            <option value="â˜• Snacks">â˜• Snacks</option>
            <option value="ğŸ“¦ Other">ğŸ“¦ Other</option>
          </select>
        </div>
      </div>
      <div class="form-grid">
        <div class="form-row"><label>Paid By</label><select id="expPaidBy"><option value="">â€” Select â€”</option></select></div>
        <div class="form-row"><label>Date</label><input type="date" id="expDate" value="2026-03-01" min="2026-03-01" max="2026-03-07"></div>
      </div>
      <button class="btn-add" onclick="addExpense()">+ Add Expense</button>
    </div>
    <div id="expensesList"></div>
  </div>

  <!-- ===== SUMMARY ===== -->
  <div class="section" id="sec-summary">
    <div class="section-title">ğŸ“Š Expense Summary</div>
    <div class="card summary-card">
      <div class="big-num" id="summaryTotalSpent">â‚¹0</div>
      <div class="big-label">Total Spent So Far</div>
    </div>
    <div class="card">
      <div class="budget-group-title" style="margin-bottom:10px">Who Paid What</div>
      <div id="splitList"></div>
    </div>
    <div class="card">
      <div class="budget-group-title" style="margin-bottom:10px">Settlements Needed</div>
      <div id="settlementsList"><div class="no-expenses">Add expenses to see settlements</div></div>
    </div>
    <button class="share-btn" onclick="shareTrip()">ğŸ“¤ Share Trip Summary</button>
    <button class="share-btn secondary" onclick="shareBudget()">ğŸ’° Share Budget to WhatsApp</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* ===== SYNC ENGINE (jsonblob.com) ===== */
const BLOB_ID = '019c1f01-b904-7118-a835-54e14b5c82c4';
const API = `https://jsonblob.com/api/jsonBlob/${BLOB_ID}`;
const POLL_MS = 5000;
let state = { members: [], expenses: [], budgetOverrides: {}, updatedAt: 0 };
let lastKnownUpdate = 0;
let syncing = false;
let pollTimer = null;

function setSyncStatus(status) {
  const dot = document.getElementById('syncDot');
  const txt = document.getElementById('syncText');
  dot.className = 'sync-dot ' + status;
  txt.textContent = status === 'synced' ? 'All devices synced âœ“' :
                    status === 'syncing' ? 'Syncing...' : 'Offline â€” retrying...';
}

async function fetchState() {
  try {
    setSyncStatus('syncing');
    const res = await fetch(API, { headers: { Accept: 'application/json' } });
    if (!res.ok) throw new Error('fetch failed');
    const data = await res.json();
    if (data.updatedAt > lastKnownUpdate) {
      state = data;
      lastKnownUpdate = data.updatedAt;
      renderAll();
    }
    setSyncStatus('synced');
  } catch (e) {
    setSyncStatus('error');
  }
}

async function pushState() {
  if (syncing) return;
  syncing = true;
  state.updatedAt = Date.now();
  lastKnownUpdate = state.updatedAt;
  try {
    setSyncStatus('syncing');
    const res = await fetch(API, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json', Accept: 'application/json' },
      body: JSON.stringify(state)
    });
    if (!res.ok) throw new Error('push failed');
    setSyncStatus('synced');
  } catch (e) {
    setSyncStatus('error');
  } finally {
    syncing = false;
  }
}

function startPolling() {
  fetchState();
  pollTimer = setInterval(fetchState, POLL_MS);
  document.addEventListener('visibilitychange', () => {
    if (document.hidden) { clearInterval(pollTimer); }
    else { fetchState(); pollTimer = setInterval(fetchState, POLL_MS); }
  });
}

/* ===== MEMBERS ===== */
function addMember() {
  const input = document.getElementById('memberName');
  const name = input.value.trim();
  if (!name) return;
  if (state.members.length >= 15) return toast('Max 15 members!');
  if (state.members.find(m => m.name.toLowerCase() === name.toLowerCase())) return toast('Already added!');
  state.members.push({ id: Date.now().toString(), name });
  input.value = '';
  pushState();
  renderAll();
  toast(`${name} added! ğŸ‰`);
}

function removeMember(id) {
  const m = state.members.find(x => x.id === id);
  if (m && confirm(`Remove ${m.name}?`)) {
    state.members = state.members.filter(x => x.id !== id);
    state.expenses = state.expenses.filter(x => x.paidBy !== id);
    pushState();
    renderAll();
  }
}

function renderMembers() {
  const el = document.getElementById('membersList');
  if (!state.members.length) {
    el.innerHTML = '<div class="empty-state"><div class="emoji">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div><div>Add your family members to get started!</div></div>';
    return;
  }
  const colors = ['#1B4332','#2D6A4F','#40916C','#52B788','#74C69D','#F77F00','#E63946','#457B9D'];
  el.innerHTML = state.members.map((m, i) => `
    <div class="member">
      <div class="name">
        <div class="avatar" style="background:${colors[i % colors.length]}">${m.name.charAt(0).toUpperCase()}</div>
        ${m.name}
      </div>
      <button class="remove" onclick="removeMember('${m.id}')">âœ•</button>
    </div>`).join('');
}

/* ===== BUDGET ===== */
function onBudgetChange() {
  state.budgetOverrides = {
    localTaxi: +document.getElementById('budgetLocalTaxi').value || 0,
    accom: +document.getElementById('budgetAccom').value || 0,
    food: +document.getElementById('budgetFood').value || 0,
    permits: +document.getElementById('budgetPermits').value || 0,
    misc: +document.getElementById('budgetMisc').value || 0,
  };
  calcBudget();
  pushState();
}

function calcBudget() {
  const n = state.members.length || 8;
  const o = state.budgetOverrides || {};
  const trainGo = 1500 * n, trainRet = 1200 * n;
  const local = o.localTaxi || 14000, accom = o.accom || 27500;
  const food = o.food || 19200, permits = o.permits || 2500, misc = o.misc || 5000;
  const total = trainGo + trainRet + 8000 + local + accom + food + permits + misc;
  const pp = Math.ceil(total / n);

  document.querySelectorAll('.m-count').forEach(el => el.textContent = n);
  document.getElementById('calcTrainGo').textContent = `â‚¹${trainGo.toLocaleString('en-IN')}`;
  document.getElementById('calcTrainReturn').textContent = `â‚¹${trainRet.toLocaleString('en-IN')}`;
  document.getElementById('budgetGrandTotal').textContent = `â‚¹${total.toLocaleString('en-IN')}`;
  document.getElementById('budgetPerPerson').textContent = `â‚¹${pp.toLocaleString('en-IN')} per person`;
  document.getElementById('statTotal').textContent = `â‚¹${(total/1000).toFixed(1)}K`;
  document.getElementById('statPP').textContent = `â‚¹${pp.toLocaleString('en-IN')}`;

  // Restore input values from state
  if (o.localTaxi) document.getElementById('budgetLocalTaxi').value = o.localTaxi;
  if (o.accom) document.getElementById('budgetAccom').value = o.accom;
  if (o.food) document.getElementById('budgetFood').value = o.food;
  if (o.permits) document.getElementById('budgetPermits').value = o.permits;
  if (o.misc) document.getElementById('budgetMisc').value = o.misc;
}

/* ===== EXPENSES ===== */
function addExpense() {
  const desc = document.getElementById('expDesc').value.trim();
  const amount = parseFloat(document.getElementById('expAmount').value);
  const category = document.getElementById('expCategory').value;
  const paidBy = document.getElementById('expPaidBy').value;
  const date = document.getElementById('expDate').value;
  if (!desc) return toast('Enter a description');
  if (!amount || amount <= 0) return toast('Enter valid amount');
  if (!paidBy) return toast('Select who paid');
  state.expenses.push({ id: Date.now().toString(), desc, amount, category, paidBy, date });
  document.getElementById('expDesc').value = '';
  document.getElementById('expAmount').value = '';
  pushState();
  renderExpenses(); renderSummary(); updateSpentStat();
  toast('Expense added! âœ…');
}

function deleteExpense(id) {
  state.expenses = state.expenses.filter(x => x.id !== id);
  pushState();
  renderExpenses(); renderSummary(); updateSpentStat();
}

function renderExpenses() {
  const el = document.getElementById('expensesList');
  if (!state.expenses.length) {
    el.innerHTML = '<div class="no-expenses">No expenses yet ğŸ§¾<br>Add them during the trip!</div>';
    return;
  }
  const grouped = {};
  [...state.expenses].sort((a, b) => b.date.localeCompare(a.date) || b.id - a.id).forEach(e => {
    (grouped[e.date] = grouped[e.date] || []).push(e);
  });
  const dayN = {'2026-03-01':'Day 1','2026-03-02':'Day 2','2026-03-03':'Day 3','2026-03-04':'Day 4','2026-03-05':'Day 5','2026-03-06':'Day 6','2026-03-07':'Day 7'};
  let html = '';
  for (const d of Object.keys(grouped).sort().reverse()) {
    const tot = grouped[d].reduce((s,e)=>s+e.amount,0);
    html += `<div class="expense-day-header">${dayN[d]||d} â€” â‚¹${tot.toLocaleString('en-IN')}</div>`;
    grouped[d].forEach(e => {
      const m = state.members.find(x=>x.id===e.paidBy);
      html += `<div class="expense-item"><div class="emoji">${e.category.split(' ')[0]}</div><div class="details"><div class="desc">${e.desc}</div><div class="meta">${e.category} Â· ${m?m.name:'?'}</div></div><div class="exp-amount">â‚¹${e.amount.toLocaleString('en-IN')}</div><button class="delete" onclick="deleteExpense('${e.id}')">ğŸ—‘ï¸</button></div>`;
    });
  }
  el.innerHTML = html;
}

function updatePaidByDropdown() {
  const sel = document.getElementById('expPaidBy');
  const cur = sel.value;
  sel.innerHTML = '<option value="">â€” Select â€”</option>' + state.members.map(m => `<option value="${m.id}" ${m.id===cur?'selected':''}>${m.name}</option>`).join('');
}

/* ===== SUMMARY ===== */
function renderSummary() {
  const total = state.expenses.reduce((s,e)=>s+e.amount,0);
  const n = state.members.length || 1;
  const pp = total / n;
  document.getElementById('summaryTotalSpent').textContent = `â‚¹${total.toLocaleString('en-IN')}`;

  const paid = {};
  state.members.forEach(m => paid[m.id] = { name: m.name, amt: 0 });
  state.expenses.forEach(e => { if (paid[e.paidBy]) paid[e.paidBy].amt += e.amount; });

  const splitEl = document.getElementById('splitList');
  if (!state.expenses.length || !state.members.length) {
    splitEl.innerHTML = '<div class="no-expenses">No data yet</div>';
  } else {
    splitEl.innerHTML = Object.values(paid).map(p => {
      const d = p.amt - pp;
      const s = d > 0.5 ? `gets back â‚¹${Math.round(d)}` : d < -0.5 ? `owes â‚¹${Math.round(Math.abs(d))}` : 'settled âœ…';
      return `<div class="split-item"><div><div class="split-name">${p.name}</div><div class="split-owe">${s}</div></div><div class="split-paid">â‚¹${p.amt.toLocaleString('en-IN')}</div></div>`;
    }).join('');
  }

  // Settlements
  const stl = document.getElementById('settlementsList');
  if (!state.expenses.length || state.members.length < 2) { stl.innerHTML = '<div class="no-expenses">Add expenses to see settlements</div>'; return; }
  const bals = Object.entries(paid).map(([id,p])=>({name:p.name,bal:p.amt-pp}));
  const debtors = bals.filter(b=>b.bal<-0.5).sort((a,b)=>a.bal-b.bal);
  const creditors = bals.filter(b=>b.bal>0.5).sort((a,b)=>b.bal-a.bal);
  let res=[], di=0, ci=0, dB=debtors[0]?Math.abs(debtors[0].bal):0, cB=creditors[0]?creditors[0].bal:0;
  while(di<debtors.length && ci<creditors.length){
    const a=Math.min(dB,cB);
    if(a>0.5) res.push({from:debtors[di].name,to:creditors[ci].name,amt:Math.round(a)});
    dB-=a; cB-=a;
    if(dB<0.5){di++; dB=debtors[di]?Math.abs(debtors[di].bal):0;}
    if(cB<0.5){ci++; cB=creditors[ci]?creditors[ci].bal:0;}
  }
  stl.innerHTML = res.length ? res.map(s=>`<div class="split-item"><div class="split-name">${s.from} â†’ ${s.to}</div><div class="split-paid">â‚¹${s.amt.toLocaleString('en-IN')}</div></div>`).join('') : '<div class="no-expenses">All settled! ğŸ‰</div>';
}

function updateSpentStat() {
  document.getElementById('statSpent').textContent = `â‚¹${state.expenses.reduce((s,e)=>s+e.amount,0).toLocaleString('en-IN')}`;
}

/* ===== SHARE ===== */
function shareTrip() {
  const n = state.members.length || 8;
  const spent = state.expenses.reduce((s,e)=>s+e.amount,0);
  let t = `ğŸ”ï¸ *Sikkim Family Trip 2026*\nğŸ“… March 1-7 | ğŸ‘¥ ${n} members\nğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ${state.members.map(m=>m.name).join(', ')||'TBD'}\n\n`;
  t += `ğŸ’° *Budget:* ${document.getElementById('budgetGrandTotal').textContent}\nğŸ‘¤ *Per Person:* ${document.getElementById('budgetPerPerson').textContent}\nğŸ§¾ *Spent:* â‚¹${spent.toLocaleString('en-IN')}\n\n`;
  t += `ğŸ—“ï¸ *Plan:*\nDay 1: ğŸš‚ Patna â†’ NJP\nDay 2: ğŸ“ Gangtok, MG Marg\nDay 3: â„ï¸ Tsomgo Lake\nDay 4: ğŸ”ï¸ Lachung\nDay 5: ğŸŒ¸ Yumthang + Zero Point\nDay 6: ğŸ›ï¸ Sightseeing â†’ NJP\nDay 7: ğŸ  NJP â†’ Patna\n\n`;
  t += `ğŸ”— ${location.href}`;
  if (navigator.share) navigator.share({title:'Sikkim Trip 2026',text:t});
  else navigator.clipboard.writeText(t).then(()=>toast('Copied! ğŸ“‹'));
}

function shareBudget() {
  const n = state.members.length || 8;
  const o = state.budgetOverrides || {};
  let t = `ğŸ’° *Sikkim Trip Budget*\n\nğŸš‚ Train: â‚¹${(2700*n).toLocaleString('en-IN')}\nğŸš Taxis: â‚¹${(8000+(o.localTaxi||14000)).toLocaleString('en-IN')}\nğŸ¨ Stay: â‚¹${(o.accom||27500).toLocaleString('en-IN')}\nğŸ½ï¸ Food: â‚¹${(o.food||19200).toLocaleString('en-IN')}\nğŸ« Permits: â‚¹${(o.permits||2500).toLocaleString('en-IN')}\nğŸ’ Misc: â‚¹${(o.misc||5000).toLocaleString('en-IN')}\n\n`;
  t += `*Total: ${document.getElementById('budgetGrandTotal').textContent}*\n*Per Person: ${document.getElementById('budgetPerPerson').textContent}*\nğŸ‘¥ ${n} members`;
  window.open(`https://wa.me/?text=${encodeURIComponent(t)}`,'_blank');
}

/* ===== TABS ===== */
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', function() {
    const name = this.dataset.tab;
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById(`sec-${name}`).classList.add('active');
    this.classList.add('active');
    // Hide about section when navigating to other tabs
    document.getElementById('aboutSection').style.display = name === 'members' ? '' : 'none';
  });
});

document.getElementById('memberName').addEventListener('keydown', e => { if(e.key==='Enter') addMember(); });

/* ===== TOAST ===== */
function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2500);
}

/* ===== RENDER ===== */
function renderAll() {
  renderMembers();
  updatePaidByDropdown();
  calcBudget();
  renderExpenses();
  renderSummary();
  updateSpentStat();
  document.getElementById('statMembers').textContent = state.members.length;
  document.getElementById('hlMembers').textContent = `${state.members.length || 8} People`;
  const today = new Date().toISOString().split('T')[0];
  const d = document.getElementById('expDate');
  if (today >= '2026-03-01' && today <= '2026-03-07') d.value = today;
}

/* ===== INIT ===== */
startPolling();
</script>
</body>
</html>
